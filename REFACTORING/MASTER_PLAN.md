# ğŸ“‹ ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚° ãƒã‚¹ã‚¿ãƒ¼ãƒ—ãƒ©ãƒ³

**ãƒãƒ¼ã‚¸ãƒ§ãƒ³:** 1.0  
**ä½œæˆæ—¥:** 2025å¹´10æœˆ25æ—¥

---

## ğŸ¯ Phase 1: å³åŠ¹æ€§ã®é«˜ã„ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°

**æœŸé–“:** 1-2é€±é–“  
**å„ªå…ˆåº¦:** ğŸ”´ æœ€é«˜  
**æœŸå¾…å‰Šæ¸›è¡Œæ•°:** ~500è¡Œ

### ã‚¿ã‚¹ã‚¯ä¸€è¦§

#### 1.1 ç¨é‡‘ãƒ˜ãƒ«ãƒ‘ãƒ¼ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ä½œæˆ
- [ ] `life_insurance/utils/__init__.py` ä½œæˆ
- [ ] `life_insurance/utils/tax_helpers.py` ä½œæˆ
  - [ ] `TaxDeductionHelper` ã‚¯ãƒ©ã‚¹å®Ÿè£…
  - [ ] `calculate_annual_tax_savings()` ãƒ¡ã‚½ãƒƒãƒ‰
  - [ ] `calculate_total_tax_savings_over_years()` ãƒ¡ã‚½ãƒƒãƒ‰
  - [ ] `get_tax_helper()` ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³é–¢æ•°
- [ ] `life_insurance/tests/test_tax_helpers.py` ä½œæˆ
  - [ ] åŸºæœ¬è¨ˆç®—ãƒ†ã‚¹ãƒˆï¼ˆ10ã‚±ãƒ¼ã‚¹ä»¥ä¸Šï¼‰
  - [ ] ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆ
  - [ ] å¢ƒç•Œå€¤ãƒ†ã‚¹ãƒˆ

**æˆåŠŸåŸºæº–:**
- âœ“ ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãŒãƒ‘ã‚¹
- âœ“ å‹ãƒ’ãƒ³ãƒˆå®Œå‚™
- âœ“ docstringå……å®Ÿ

#### 1.2 æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã®ç½®æ›
- [ ] `streamlit_app.py` ã®é‡è¤‡ã‚³ãƒ¼ãƒ‰ç‰¹å®šï¼ˆå®Œäº†æ¸ˆã¿: 30ç®‡æ‰€ï¼‰
- [ ] æ®µéšçš„ç½®æ›ï¼ˆ10ç®‡æ‰€ãšã¤æ¨å¥¨ï¼‰
  - [ ] 1-10ç®‡æ‰€ç›®ã®ç½®æ›
  - [ ] 11-20ç®‡æ‰€ç›®ã®ç½®æ›
  - [ ] 21-30ç®‡æ‰€ç›®ã®ç½®æ›
- [ ] å„ç½®æ›å¾Œã«ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
- [ ] UIå‹•ä½œç¢ºèª

**æˆåŠŸåŸºæº–:**
- âœ“ å…¨ç½®æ›å®Œäº†
- âœ“ æ—¢å­˜ãƒ†ã‚¹ãƒˆå…¨ãƒ‘ã‚¹
- âœ“ Streamlitã‚¢ãƒ—ãƒªãŒæ­£å¸¸èµ·å‹•
- âœ“ è¨ˆç®—çµæœãŒå¤‰æ›´å‰ã¨ä¸€è‡´

#### 1.3 comparison_app.pyã®æ›´æ–°
- [ ] `comparison_app.py` ã§ã‚‚tax_helpersã‚’åˆ©ç”¨
- [ ] é‡è¤‡ã‚³ãƒ¼ãƒ‰å‰Šé™¤
- [ ] ãƒ†ã‚¹ãƒˆç¢ºèª

**æˆåŠŸåŸºæº–:**
- âœ“ æ¯”è¼ƒã‚¢ãƒ—ãƒªãŒæ­£å¸¸å‹•ä½œ

---

## ğŸ¯ Phase 2: ã‚³ã‚¢è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ã®çµ±åˆ

**æœŸé–“:** 2-3é€±é–“  
**å„ªå…ˆåº¦:** ğŸŸ  é«˜  
**æœŸå¾…å‰Šæ¸›è¡Œæ•°:** ~800è¡Œ

### ã‚¿ã‚¹ã‚¯ä¸€è¦§

#### 2.1 ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒ©ã‚¹è¨­è¨ˆ
- [ ] `life_insurance/models/__init__.py` ä½œæˆ
- [ ] `life_insurance/models/plans.py` ä½œæˆ
  - [ ] `InsurancePlan` ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒ©ã‚¹
  - [ ] `FundPlan` ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒ©ã‚¹
  - [ ] ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³è¿½åŠ 

#### 2.2 çµ±åˆè¨ˆç®—ã‚¨ãƒ³ã‚¸ãƒ³å®Ÿè£…
- [ ] `life_insurance/analysis/insurance_calculator.py` ä½œæˆ
  - [ ] `InsuranceValueCalculator` ã‚¯ãƒ©ã‚¹
  - [ ] `calculate_simple_accumulation()` ãƒ¡ã‚½ãƒƒãƒ‰
  - [ ] `calculate_partial_withdrawal()` ãƒ¡ã‚½ãƒƒãƒ‰
  - [ ] `optimize_partial_withdrawal_strategy()` ãƒ¡ã‚½ãƒƒãƒ‰
  - [ ] `calculate_switching_value()` ãƒ¡ã‚½ãƒƒãƒ‰

#### 2.3 æ—¢å­˜é–¢æ•°ã®çµ±åˆ
- [ ] `_calculate_partial_withdrawal_value()` â†’ å‰Šé™¤
- [ ] `_calculate_partial_withdrawal_value_enhanced()` â†’ å‰Šé™¤
- [ ] `_calculate_simple_insurance_value()` â†’ å‰Šé™¤
- [ ] `_calculate_switching_value()` â†’ çµ±åˆ
- [ ] `calculate_partial_withdrawal_strategy()` â†’ ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
- [ ] `optimize_partial_withdrawal_strategy()` â†’ ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ

#### 2.4 ãƒ†ã‚¹ãƒˆè¿½åŠ 
- [ ] `life_insurance/tests/test_insurance_calculator.py` ä½œæˆ
  - [ ] å˜ç´”ç©ç«‹è¨ˆç®—ãƒ†ã‚¹ãƒˆ
  - [ ] éƒ¨åˆ†è§£ç´„è¨ˆç®—ãƒ†ã‚¹ãƒˆ
  - [ ] æœ€é©åŒ–ãƒ†ã‚¹ãƒˆ
  - [ ] ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ç¶²ç¾…

**æˆåŠŸåŸºæº–:**
- âœ“ è¨ˆç®—ç²¾åº¦ãŒå…ƒã®å®Ÿè£…ã¨ä¸€è‡´
- âœ“ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åŠ£åŒ–ãªã—
- âœ“ ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸80%ä»¥ä¸Š

---

## ğŸ¯ Phase 3: å…±é€šåŸºç›¤æ§‹ç¯‰

**æœŸé–“:** 3-4é€±é–“  
**å„ªå…ˆåº¦:** ğŸŸ¡ ä¸­  
**æœŸå¾…å‰Šæ¸›è¡Œæ•°:** ~200è¡Œ

### ã‚¿ã‚¹ã‚¯ä¸€è¦§

#### 3.1 å…±é€šãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ä½œæˆ
- [ ] `common/__init__.py` ä½œæˆ
- [ ] `common/calculators/__init__.py` ä½œæˆ
- [ ] `common/models/__init__.py` ä½œæˆ
- [ ] `common/utils/__init__.py` ä½œæˆ

#### 3.2 åŸºåº•ã‚¯ãƒ©ã‚¹å®Ÿè£…
- [ ] `common/calculators/base_calculator.py`
  - [ ] `BaseFinancialCalculator` æŠ½è±¡ã‚¯ãƒ©ã‚¹
  - [ ] `CompoundInterestMixin`
- [ ] `common/models/financial_plan.py`
  - [ ] `FinancialPlan` åŸºåº•ã‚¯ãƒ©ã‚¹

#### 3.3 æ•°å­¦ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
- [ ] `common/utils/math_utils.py`
  - [ ] è¤‡åˆ©è¨ˆç®—é–¢æ•°
  - [ ] å¹´é‡‘ç¾ä¾¡è¨ˆç®—
  - [ ] IRRè¨ˆç®—

#### 3.4 æ—¥ä»˜ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
- [ ] `common/utils/date_utils.py`
  - [ ] å¹´é½¢è¨ˆç®—
  - [ ] æœŸé–“è¨ˆç®—
  - [ ] å’Œæš¦å¤‰æ›

#### 3.5 æ—¢å­˜ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ç§»è¡Œ
- [ ] `life_insurance` ã§ã®å…±é€šåŸºç›¤åˆ©ç”¨
- [ ] `pension_calc` ã§ã®å…±é€šåŸºç›¤åˆ©ç”¨

**æˆåŠŸåŸºæº–:**
- âœ“ ä¸¡ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§å…±é€šã‚³ãƒ¼ãƒ‰åˆ©ç”¨
- âœ“ ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼ãªã—
- âœ“ ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãƒ‘ã‚¹

---

## ğŸ¯ Phase 4: UIå±¤ã®æœ€é©åŒ–

**æœŸé–“:** 1-2é€±é–“  
**å„ªå…ˆåº¦:** ğŸŸ¢ ä½  
**æœŸå¾…å‰Šæ¸›è¡Œæ•°:** ~300è¡Œ

### ã‚¿ã‚¹ã‚¯ä¸€è¦§

#### 4.1 UIå…±é€šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- [ ] `common/ui/__init__.py` ä½œæˆ
- [ ] `common/ui/input_components.py`
  - [ ] `FinancialInputs` ã‚¯ãƒ©ã‚¹
  - [ ] å¹´åå…¥åŠ›
  - [ ] ä¿é™ºæ–™å…¥åŠ›
  - [ ] åˆ©ç‡ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼
  - [ ] å¹´é½¢ç¯„å›²å…¥åŠ›

#### 4.2 å¯è¦–åŒ–ãƒ˜ãƒ«ãƒ‘ãƒ¼
- [ ] `life_insurance/utils/visualization.py`
  - [ ] `FinancialChartBuilder` ã‚¯ãƒ©ã‚¹
  - [ ] ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³æ¯”è¼ƒãƒãƒ£ãƒ¼ãƒˆ
  - [ ] ãƒãƒ¼ãƒãƒ£ãƒ¼ãƒˆ
  - [ ] ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—

#### 4.3 UIé–¢æ•°ã®ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
- [ ] `streamlit_app.py` ã®å…¥åŠ›éƒ¨åˆ†ã‚’å…±é€šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåŒ–
- [ ] ãƒ—ãƒ­ãƒƒãƒˆç”Ÿæˆã‚’å¯è¦–åŒ–ãƒ˜ãƒ«ãƒ‘ãƒ¼åˆ©ç”¨ã«å¤‰æ›´
- [ ] `pension_calc/ui/streamlit_app.py` ã‚‚åŒæ§˜ã«æ›´æ–°

**æˆåŠŸåŸºæº–:**
- âœ“ UIä¸€è²«æ€§å‘ä¸Š
- âœ“ ã‚³ãƒ¼ãƒ‰å‰Šæ¸›
- âœ“ å‹•ä½œç¢ºèªå®Œäº†

---

## ğŸ“Š é€²æ—ãƒ¡ãƒˆãƒªã‚¯ã‚¹

å„Phaseã§ä»¥ä¸‹ã‚’æ¸¬å®š:

- **ã‚³ãƒ¼ãƒ‰å‰Šæ¸›ç‡:** (å‰Šæ¸›è¡Œæ•° / å…ƒã®è¡Œæ•°) Ã— 100
- **ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸:** pytest-cov ã§æ¸¬å®š
- **é–¢æ•°ã®å¹³å‡è¡Œæ•°:** è‡ªå‹•ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§æ¸¬å®š
- **é‡è¤‡ã‚³ãƒ¼ãƒ‰æ¤œå‡º:** pylint --disable=all --enable=duplicate-code

### æ¸¬å®šã‚³ãƒãƒ³ãƒ‰
```bash
# è¡Œæ•°ã‚«ã‚¦ãƒ³ãƒˆ
find . -name "*.py" -not -path "*/tests/*" -not -path "*/.venv/*" | xargs wc -l

# ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸
pytest --cov=life_insurance --cov=pension_calc --cov-report=term-missing

# é‡è¤‡ã‚³ãƒ¼ãƒ‰æ¤œå‡º
pylint --disable=all --enable=duplicate-code life_insurance/ pension_calc/
```

---

## ğŸ”„ ç¶™ç¶šçš„æ”¹å–„ãƒ—ãƒ­ã‚»ã‚¹

### é€±æ¬¡ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆé‡‘æ›œæ—¥æ¨å¥¨ï¼‰
1. ä»Šé€±ã®å®Œäº†ã‚¿ã‚¹ã‚¯ç¢ºèª
2. æ¬¡é€±ã®ã‚¿ã‚¹ã‚¯å„ªå…ˆé †ä½è¨­å®š
3. ãƒ–ãƒ­ãƒƒã‚«ãƒ¼ã®ç‰¹å®šã¨è§£æ±ºç­–æ¤œè¨
4. ãƒ¡ãƒˆãƒªã‚¯ã‚¹æ¸¬å®šã¨è¨˜éŒ²

### æœˆæ¬¡æŒ¯ã‚Šè¿”ã‚Š
1. Phaseé€²æ—ã®ç¢ºèª
2. ç›®æ¨™é”æˆåº¦è©•ä¾¡
3. å¿…è¦ã«å¿œã˜ãŸè¨ˆç”»èª¿æ•´
4. ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°

---

## âš™ï¸ é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### æ¨å¥¨ãƒ„ãƒ¼ãƒ«
```bash
# ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯
pip install pylint flake8 mypy black isort

# ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«
pip install pytest pytest-cov

# å®Ÿè¡Œ
black life_insurance/ pension_calc/ common/
isort life_insurance/ pension_calc/ common/
mypy life_insurance/ pension_calc/ common/
```

### pre-commitãƒ•ãƒƒã‚¯ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
```yaml
# .pre-commit-config.yaml
repos:
  - repo: https://github.com/psf/black
    rev: 23.3.0
    hooks:
      - id: black
  - repo: https://github.com/pycqa/isort
    rev: 5.12.0
    hooks:
      - id: isort
  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.3.0
    hooks:
      - id: mypy
```

---

## ğŸ“š å‚è€ƒè³‡æ–™

- [Pythonã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„ PEP 8](https://peps.python.org/pep-0008/)
- [Google Pythonã‚¹ã‚¿ã‚¤ãƒ«ã‚¬ã‚¤ãƒ‰](https://google.github.io/styleguide/pyguide.html)
- [ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°: æ—¢å­˜ã®ã‚³ãƒ¼ãƒ‰ã‚’å®‰å…¨ã«æ”¹å–„ã™ã‚‹](https://martinfowler.com/books/refactoring.html)

---

**æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³:** Phase 1ã®ã‚¿ã‚¹ã‚¯ã‹ã‚‰é–‹å§‹ã—ã¦ãã ã•ã„  
è©³ç´°ã¯ `REFACTORING/PHASE_1/` ã‚’å‚ç…§
